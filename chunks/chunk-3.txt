================================================================================
CHUNK 4 OF 6
================================================================================


========================================
File: ./tests/data/chunks/chunk-6.txt
========================================

================================================================================
CHUNK 7
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_13.txt
========================================

Content 13


========================================
File: ./tests/data/chunks/chunk-60.txt
========================================

================================================================================
CHUNK 61
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_62.txt
========================================

Content 62


========================================
File: ./tests/data/chunks/chunk-61.txt
========================================

================================================================================
CHUNK 62
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_63.txt
========================================

Content 63


========================================
File: ./tests/data/chunks/chunk-62.txt
========================================

================================================================================
CHUNK 63
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_64.txt
========================================

Content 64


========================================
File: ./tests/data/chunks/chunk-63.txt
========================================

================================================================================
CHUNK 64
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_65.txt
========================================

Content 65


========================================
File: ./tests/data/chunks/chunk-64.txt
========================================

================================================================================
CHUNK 65
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_66.txt
========================================

Content 66


========================================
File: ./tests/data/chunks/chunk-65.txt
========================================

================================================================================
CHUNK 66
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_67.txt
========================================

Content 67


========================================
File: ./tests/data/chunks/chunk-66.txt
========================================

================================================================================
CHUNK 67
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_68.txt
========================================

Content 68


========================================
File: ./tests/data/chunks/chunk-67.txt
========================================

================================================================================
CHUNK 68
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_69.txt
========================================

Content 69


========================================
File: ./tests/data/chunks/chunk-68.txt
========================================

================================================================================
CHUNK 69
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_7.txt
========================================

Content 7


========================================
File: ./tests/data/chunks/chunk-69.txt
========================================

================================================================================
CHUNK 70
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_70.txt
========================================

Content 70


========================================
File: ./tests/data/chunks/chunk-7.txt
========================================

================================================================================
CHUNK 8
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_14.txt
========================================

Content 14


========================================
File: ./tests/data/chunks/chunk-70.txt
========================================

================================================================================
CHUNK 71
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_71.txt
========================================

Content 71


========================================
File: ./tests/data/chunks/chunk-71.txt
========================================

================================================================================
CHUNK 72
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_72.txt
========================================

Content 72


========================================
File: ./tests/data/chunks/chunk-72.txt
========================================

================================================================================
CHUNK 73
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_73.txt
========================================

Content 73


========================================
File: ./tests/data/chunks/chunk-73.txt
========================================

================================================================================
CHUNK 74
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_74.txt
========================================

Content 74


========================================
File: ./tests/data/chunks/chunk-74.txt
========================================

================================================================================
CHUNK 75
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_75.txt
========================================

Content 75


========================================
File: ./tests/data/chunks/chunk-75.txt
========================================

================================================================================
CHUNK 76
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_76.txt
========================================

Content 76


========================================
File: ./tests/data/chunks/chunk-76.txt
========================================

================================================================================
CHUNK 77
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_77.txt
========================================

Content 77


========================================
File: ./tests/data/chunks/chunk-77.txt
========================================

================================================================================
CHUNK 78
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_78.txt
========================================

Content 78


========================================
File: ./tests/data/chunks/chunk-78.txt
========================================

================================================================================
CHUNK 79
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_79.txt
========================================

Content 79


========================================
File: ./tests/data/chunks/chunk-79.txt
========================================

================================================================================
CHUNK 80
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_8.txt
========================================

Content 8


========================================
File: ./tests/data/chunks/chunk-8.txt
========================================

================================================================================
CHUNK 9
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_15.txt
========================================

Content 15


========================================
File: ./tests/data/chunks/chunk-80.txt
========================================

================================================================================
CHUNK 81
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_80.txt
========================================

Content 80


========================================
File: ./tests/data/chunks/chunk-81.txt
========================================

================================================================================
CHUNK 82
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_81.txt
========================================

Content 81


========================================
File: ./tests/data/chunks/chunk-82.txt
========================================

================================================================================
CHUNK 83
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_82.txt
========================================

Content 82


========================================
File: ./tests/data/chunks/chunk-83.txt
========================================

================================================================================
CHUNK 84
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_83.txt
========================================

Content 83


========================================
File: ./tests/data/chunks/chunk-84.txt
========================================

================================================================================
CHUNK 85
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_84.txt
========================================

Content 84


========================================
File: ./tests/data/chunks/chunk-85.txt
========================================

================================================================================
CHUNK 86
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_85.txt
========================================

Content 85


========================================
File: ./tests/data/chunks/chunk-86.txt
========================================

================================================================================
CHUNK 87
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_86.txt
========================================

Content 86


========================================
File: ./tests/data/chunks/chunk-87.txt
========================================

================================================================================
CHUNK 88
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_87.txt
========================================

Content 87


========================================
File: ./tests/data/chunks/chunk-88.txt
========================================

================================================================================
CHUNK 89
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_88.txt
========================================

Content 88


========================================
File: ./tests/data/chunks/chunk-89.txt
========================================

================================================================================
CHUNK 90
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_89.txt
========================================

Content 89


========================================
File: ./tests/data/chunks/chunk-9.txt
========================================

================================================================================
CHUNK 10
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_16.txt
========================================

Content 16


========================================
File: ./tests/data/chunks/chunk-90.txt
========================================

================================================================================
CHUNK 91
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_9.txt
========================================

Content 9


========================================
File: ./tests/data/chunks/chunk-91.txt
========================================

================================================================================
CHUNK 92
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_90.txt
========================================

Content 90


========================================
File: ./tests/data/chunks/chunk-92.txt
========================================

================================================================================
CHUNK 93
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_91.txt
========================================

Content 91


========================================
File: ./tests/data/chunks/chunk-93.txt
========================================

================================================================================
CHUNK 94
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_92.txt
========================================

Content 92


========================================
File: ./tests/data/chunks/chunk-94.txt
========================================

================================================================================
CHUNK 95
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_93.txt
========================================

Content 93


========================================
File: ./tests/data/chunks/chunk-95.txt
========================================

================================================================================
CHUNK 96
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_94.txt
========================================

Content 94


========================================
File: ./tests/data/chunks/chunk-96.txt
========================================

================================================================================
CHUNK 97
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_95.txt
========================================

Content 95


========================================
File: ./tests/data/chunks/chunk-97.txt
========================================

================================================================================
CHUNK 98
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_96.txt
========================================

Content 96


========================================
File: ./tests/data/chunks/chunk-98.txt
========================================

================================================================================
CHUNK 99
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_97.txt
========================================

Content 97


========================================
File: ./tests/data/chunks/chunk-99.txt
========================================

================================================================================
CHUNK 100
================================================================================

========================================
File: /var/folders/sz/zrbjt3sn56x7yvwg_nk4hh640000gn/T/tmpxcz4q8uz/file_98.txt
========================================

Content 98


========================================
File: ./tests/data/test_cli.py
========================================

import unittest
import os
import tempfile
import shutil
from pykomodo.multi_dirs_chunker import ParallelChunker
from unittest.mock import patch
import sys

class TestCLIScript(unittest.TestCase):
    def setUp(self):
        self.test_dir = tempfile.mkdtemp()
        self.file_txt = os.path.join(self.test_dir, "example.txt")
        with open(self.file_txt, "w", encoding="utf-8") as f:
            f.write("Some file contents\nFor testing the script.")
        
        self.output_dir = os.path.join(self.test_dir, "output")
        os.makedirs(self.output_dir)

    def tearDown(self):
        shutil.rmtree(self.test_dir)

    def test_equal_chunks_cli(self):
        from src.pykomodo.command_line import main 
        
        test_args = [
            sys.argv[0],  
            self.test_dir,
            '--equal-chunks', '5',
            '--output-dir', self.output_dir
        ]
        
        with patch('sys.argv', test_args):
            try:
                main()
            except SystemExit as e:
                if e.code != 0:  
                    self.fail(f"CLI failed with exit code: {e.code}")

        chunk_files = [f for f in os.listdir(self.output_dir) if f.startswith('chunk-')]
        self.assertEqual(len(chunk_files), 5, "Should create exactly 5 chunks")

    def test_max_chunk_size_cli(self):
        from src.pykomodo.command_line import main 
        
        test_args = [
            sys.argv[0],  
            self.test_dir,
            '--max-chunk-size', '100',
            '--output-dir', self.output_dir
        ]
        
        with patch('sys.argv', test_args):
            try:
                main()
            except SystemExit as e:
                if e.code != 0:  
                    self.fail(f"CLI failed with exit code: {e.code}")

        chunk_files = [f for f in os.listdir(self.output_dir) if f.startswith('chunk-')]
        self.assertTrue(len(chunk_files) > 0, "Should create at least one chunk")

    def test_priority_rules_cli(self):
        from src.pykomodo.command_line import main 
        
        test_args = [
            sys.argv[0],  
            self.test_dir,
            '--max-chunk-size', '100',
            '--priority', '*.txt,10',
            '--priority', '*.md,5',
            '--output-dir', self.output_dir
        ]
        
        with patch('sys.argv', test_args):
            try:
                main()
            except SystemExit as e:
                if e.code != 0:  
                    self.fail(f"CLI failed with exit code: {e.code}")

    def test_missing_required_args(self):
        from src.pykomodo.command_line import main 
        
        test_args = [
            sys.argv[0],  
            self.test_dir,
            '--output-dir', self.output_dir
        ]
        
        with patch('sys.argv', test_args):
            with self.assertRaises(SystemExit) as cm:
                main()
            self.assertNotEqual(cm.exception.code, 0, 
                "Should exit with error when missing required chunking argument")

    def test_mutually_exclusive_args(self):
        from src.pykomodo.command_line import main 
        
        test_args = [
            sys.argv[0],  
            self.test_dir,
            '--equal-chunks', '5',
            '--max-chunk-size', '100',
            '--output-dir', self.output_dir
        ]
        
        with patch('sys.argv', test_args):
            with self.assertRaises(SystemExit) as cm:
                main()
            self.assertNotEqual(cm.exception.code, 0, 
                "Should exit with error when both chunking arguments are provided")

if __name__ == "__main__":
    unittest.main()

========================================
File: ./tests/data/test_core.py
========================================

import unittest
import os
import tempfile
import shutil
from pykomodo.core import PyCConfig, PriorityRule

class TestPyCConfig(unittest.TestCase):
    def setUp(self):
        self.config = PyCConfig()
        self.test_dir = tempfile.mkdtemp()
        self.test_file_txt = os.path.join(self.test_dir, "example.txt")
        self.test_file_bin = os.path.join(self.test_dir, "binary.bin")
        with open(self.test_file_txt, "w", encoding="utf-8") as f:
            f.write("some text data\nwith multiple lines\n")
        with open(self.test_file_bin, "wb") as f:
            f.write(b"\x00\x01\x02somebinary")

    def tearDown(self):
        shutil.rmtree(self.test_dir)

    def test_add_ignore_pattern(self):
        self.config.add_ignore_pattern("*.txt")
        self.assertIn("*.txt", self.config.ignore_patterns)

    def test_add_unignore_pattern(self):
        self.config.add_unignore_pattern("*.md")
        self.assertIn("*.md", self.config.unignore_patterns)

    def test_add_priority_rule(self):
        self.config.add_priority_rule("*.py", 10)
        self.assertTrue(any(r.pattern == "*.py" and r.score == 10 for r in self.config.priority_rules))

    def test_should_ignore(self):
        self.config.add_ignore_pattern("*.txt")
        self.assertTrue(self.config.should_ignore("example.txt"))
        self.config.add_unignore_pattern("example.txt")
        self.assertFalse(self.config.should_ignore("example.txt"))

    def test_calculate_priority(self):
        self.config.add_priority_rule("*.txt", 5)
        self.config.add_priority_rule("*example*", 10)
        self.assertEqual(self.config.calculate_priority("example.txt"), 10)
        self.assertEqual(self.config.calculate_priority("other.txt"), 5)
        self.assertEqual(self.config.calculate_priority("none.dat"), 0)

    def test_is_binary_file(self):
        self.config.binary_exts = ["bin"]
        self.assertTrue(self.config.is_binary_file(self.test_file_bin))
        self.assertFalse(self.config.is_binary_file(self.test_file_txt))

    def test_read_file_contents(self):
        contents_txt = self.config.read_file_contents(self.test_file_txt)
        self.assertIn("some text data", contents_txt)
        contents_missing = self.config.read_file_contents("does_not_exist.txt")
        self.assertEqual(contents_missing, "<NULL>")

    def test_count_tokens(self):
        text = "this is a test with  seven tokens"
        count = self.config.count_tokens(text)
        self.assertEqual(count, 7)

    def test_make_c_string(self):
        self.assertEqual(self.config.make_c_string(None), "<NULL>")
        self.assertEqual(self.config.make_c_string("data"), "data")

if __name__ == "__main__":
    unittest.main()

